package adventofcode.aoc2023.day21;

import java.util.ArrayDeque;
import java.util.HashSet;
import java.util.Queue;
import java.util.Set;

public class Main2 {

    static String s =
            "...........\n" +
            ".....###.#.\n" +
            ".###.##..#.\n" +
            "..#.#...#..\n" +
            "....#.#....\n" +
            ".##..S####.\n" +
            ".##..#...#.\n" +
            ".......##..\n" +
            ".##.#.####.\n" +
            ".##..##.##.\n" +
            "...........";

    static String sq = "...................................................................................................................................\n" +
            "..#.......#.#.##...........#...#..................#......................#.......#.......#............#...............#.....#...#..\n" +
            "................#....#.#.....#.#..#.#..#.........#.....................#......................#......#....#..........#.............\n" +
            "..#.##.....................#......##..#...##.#............................#.....#..............#..................#..#......#......\n" +
            ".....#.#.....#...#........#............#.#.#..#.#...#.........................................##......#..........#.#..##...........\n" +
            ".....#....##.........#.......##............##....#.............................#.........#.....#....#.#....#...........#.##........\n" +
            "...........#..#...#...........#.....##................#.........#..#...................#.#..#.....#................................\n" +
            "..#.....#....#....#....#......#.#.............................................###.#.......#....#..........#.#....#.....#...........\n" +
            "....#........................#............#.......#...............#..#.......#..........#.........#....#......#..##.........#......\n" +
            "..........#...#..........#..#............##.........#...........#...............................#.........#........#........#......\n" +
            "....#............#.#...........#.............#..#..............................##.#....#...#.#.#.#.#........#......#..#............\n" +
            "....#..#...#.#....#.#.##..#...................##..#........#.##....................#............#......#........#...#..............\n" +
            "......#.....#...##...#...#......##.....#.....#.#...............#....................#.#......#.............#..........#.........#..\n" +
            "......#....#..#...........##...#.#.#.#.#......##...........#.......#.....##.............#.#..##...##....................#.......#..\n" +
            "......................................#.#......#.......#....#...#.#..#...#............#..#........####......#....##................\n" +
            "..#........#........#.............#....................#.......#....#.....#................#...................#..........#........\n" +
            "..................#.....#.#.#....#......#.....................#............#...............#..#......#...#..##......#............#.\n" +
            "...#........#....#......#............................#.......#....#........#.#............................#..#....#......##........\n" +
            "..#..........#...#..................#......................#......#........#.............#....#..##.#......##......##.#............\n" +
            "...........#..........#......#..#...#.#...........#.......#.....#.....#..#...............#..............#...#.....#.##.......#.....\n" +
            ".#......#..#....#..................................................#..#......#.........................#.......#.....#.....#.....#.\n" +
            ".....##..................#............................#...#........#..#....#.#..............#.....................##.......#..##...\n" +
            ".........#...#......#.....###..........#...............#.......#..................................#.........##....#.......#........\n" +
            "....#........#.................#..............#.#......#...##...#....#...#.....#...................#....#...#.....#....#.#.........\n" +
            ".....#....##....#.............#...#..........................#..................#.................#..........#..............##...#.\n" +
            "....#.#..#....#.................#............................#......#.#................................#..##......##.....#.........\n" +
            "......#.................#........#.........#......##....#...#.#........#...#.....#.....................##........#..#..#...........\n" +
            "..........#.#.......#......#.....#..................##.......#........#.....##....#.............#.................#.#..#...........\n" +
            ".#.#....##.#.#.......#...................##....#...#..........#.........#.#..##.#.......#........#....#....#.#..........##....#....\n" +
            "...............#......#...#..............###......#.............#....#...##........#.................#....#.................##.#...\n" +
            ".......#....#.......#.....##.#................#...........#....................#.....##...##.........#....................##....#..\n" +
            ".................#.....#........................#........#.....#........#...#......#................#............................#.\n" +
            "..........#.................#........#..#.....................#...........##.#..............#..................#.................#.\n" +
            ".#.#.#................................#...#.#...#.........#...#.....#...........#..........#.#........#.#.#..........#.....#.......\n" +
            ".#..#...#..#...............#.................#...##...#........#........#....####......#....#.............#..#...#.............#.#.\n" +
            "............##........#...............#.#......................#...#..#...##..##..........#...#.........#..........##.......#......\n" +
            ".........#.#.#...#......#.....................##...............#..#.###........#............#..#......................#......##....\n" +
            ".#........##.......#.............#.#..........#..#........#..#.#.................................#..................#......#.#.....\n" +
            "..##...#....#..........................#...#.#.#.........#..#............#.......#....#..............................#....#........\n" +
            "......#.....##....#...................#...................#........#...#....#...........#..#.....#.................#.#..#.......##.\n" +
            "....##...#......................#.##..#....#...#.....#..................#..#...........#.....#................#...##...........##..\n" +
            "...............##...............#.................#.......##..........................#...#.#.........#........#........#......#...\n" +
            ".##....#....#...#...........#.....##....#..............#...#.........#...#.....##.....#........##.#.#...................#.......#..\n" +
            ".#............................#.....#...#....#.#.....#.....#.###.............#...............................................#..#..\n" +
            "..........#..................#...#......#...............#.#.......#............#..........#....#.................#....#.......#....\n" +
            ".#..#....#...#....................#......#........#.......#...#.#........#.#..........#.............#..##...........#..#...........\n" +
            "....#......#..................#.......#.......###..#.#.#...........#.#............#................#.....#...........##..#.##..#...\n" +
            ".......#.#.#...................#.##...........#.........#...#............#.....##....#..........#.....#.#.............#.#...#......\n" +
            "............#........##....#...........#.............................#.#.#....#..#......#.................#..........#......#.#....\n" +
            ".....##.#.........................#.#...##.#..#....#..........#..........#............#.......#..##.....##.##..............#.......\n" +
            "..#..#......................................#.......#.#..#.#.........#.....#...............#.....................................#.\n" +
            "......#........................#.......#.#............................#..#..#.......#......#.....#............#.#................#.\n" +
            "...###.#.........#..##......#............#.............###......#....#....##...................##...#..#.#....#.............#.#.#..\n" +
            "..##....#...........#.............#..#..#.#..........#..............#...#........#..##..#.........................#.......#........\n" +
            ".#.....#.............##.....#.....###.#.#..#.......#......#..#........#..............#.#....#.....................#...........#....\n" +
            "....#.........................#....##......#..#......#.#.....#.#.....#.................#.................#.........#...............\n" +
            ".#............#.........#........#.#.#.....#.....#...#.....#......#......#...............#.#.........#.............................\n" +
            "................##...#...#......#....#....#.........##.............#.......#.....#.......................#..###..#...##............\n" +
            "...........#.#..............#..#.......#....#.#.....#..............................#..##....................#.#......#.............\n" +
            "..................#....................#............................##.#..#.#..........#..................#............#...........\n" +
            ".............#.....#.......##...#..#........#.................##......#......#.#..............#..........#........#.#.#............\n" +
            "...........................#....##...#.###...........#.#..........#.............#.....#.#....#.....#....#..........#...............\n" +
            ".............#........##........#.#.#..##....#......#.............#.#....#.#.#...#...#....#.#..#.......#...........##..#...........\n" +
            "......#..#.....#........##.....#......#......#.#....#.#..#...#.........#.........#..............#..........###.....................\n" +
            ".............#..........#..#...####..........#......#..#....#.........#..##............##.....#..#.....##.#......#.#....#..#.#.....\n" +
            ".................................................................S.................................................................\n" +
            ".....................#.....#.#........##......#......##..#..#.......#.##..#...........................#..#.........................\n" +
            "......................#.#..........##....................#.................#......#..#.....................##.....#.......#........\n" +
            "................#..........#...#.....................#....#..........#.##.....##........#......#........##....#..........##........\n" +
            ".........##...#.#..#.....#.#...#.#................#.........#.......#..##..#.....#...#...##....#...#............#....##............\n" +
            "...........................#..#..#...#..#...##..................................................##.........##.#...#................\n" +
            "............#..#.........#........#.......#......#...#......##.##.................#.#........##.#....#....#.#...#....#.............\n" +
            "...........#..#.....#..#..#......#.#..#............#............#.........#..#.....#..#........#..............##.......#.......##..\n" +
            "...................#....##...........#.#......#.......##..#..#.#.....#...#...#.##..............#.##....#....#.#.....#.........#....\n" +
            "..................#..#....#......#.#...........#...#.......#........#...#......#...........#.....................#.#.............#.\n" +
            "................#...........#.............#.#.....#.........................##.#....#..#..........#.#...#....#................##.#.\n" +
            "......##........#.#......#..........#..........#..........................#...#..........###.#..............................##.....\n" +
            ".....#..............#........#.....#.#..#....#........##........#..#......#......#......#..#......#......##...................#....\n" +
            ".#................#.....#...........#.#.........#.#.....#.##.............#...........#.#.#....##.#..........#...............#.#..#.\n" +
            "..#..#.............#...............#....#..........#..#.....#...#...............##.....#...#............#.#...................#....\n" +
            "......#............#.....#.................#..............##.#......##............#....#..#.#..#.#.#.............................#.\n" +
            "...#..................##..........#..........#...#.................#.......#.....#...#...................#..................#.#....\n" +
            ".#....##....................#...#...#.........#.#....#...#.#.......#..##..#.#....#........##.#....##......#..........#...#....#..#.\n" +
            "....#.........#............#..#.....#.#.....#.#..#.....#................#..........#.....##...........................##...........\n" +
            ".#............................#...............#...#.#.........#.....#...#..........#...#.......##..#..................##.##....#...\n" +
            ".......#..................#.#.............#.......#....#............................#...................#.#........................\n" +
            ".........#........................####......#......##...##............#.....#...#...##.......#.....#.............#.##.#............\n" +
            "..#..#.##......#..........#..............#............#...................##...................#..#.....#.......#.....#...#...##...\n" +
            "....#..#...........................#.........#...#.........#.#.....#.............#.......#............#.................###.#....#.\n" +
            "...#.......#.#.......................##....#.......................#............#......#.....#..#....#..........#.......#..........\n" +
            ".......#.........##.#................#.........#.#..#.........#.....#.#...............#.#....#....#............#.....#.............\n" +
            "..................#.#.......................#................##......#...............#......................#..#.#.#..........##...\n" +
            "......##.......#.......#............#.....#........#.....##....#.....#.............#.#....#.....#.............#......#.............\n" +
            "...#.........#.....#...............#.........#.....#..........#...#.........#....#.#.......###..#.#..............#.................\n" +
            ".........#....##.#...#............#.....................#...........##......#..#..##......#.................#..#.##................\n" +
            ".........#.........#...##..............#.#...#..###........#.#......#...#..#............#.......#.............#.....#.......#....#.\n" +
            ".....................#...#..........#.#............#...#.#.##..##..........#..#........#.......#........#.......#..#.....#.#.....#.\n" +
            "....#..........#....................#...............................#.##.##.......###.........#........#....#.................####.\n" +
            "..........#...#.............##..................#..#....#............#...................#..#.............#.......#...#.......#....\n" +
            ".#....#..##......#.#.##.....#.............................##.#............#.#..............#.........#.................#......#....\n" +
            "..#.........#.....#........#................#...#...................#..............#..#............#...#...#...................#...\n" +
            "....#..#..#..#...........#................#......#...#......#.....#........#...#...##.#..............#........#.#......#..#..#.#...\n" +
            "......##..#..#..............##...........#.#...#............#...#.#.....#.#.....#.......##...............#.#.......................\n" +
            ".......#.........#.........#..............#...#......................#....#....#........#.......#.........#......#.................\n" +
            "...#..#.........#...#...#........#...............#............#....###.#.#.........#...............#................#.......#....#.\n" +
            ".......#.....#........#..........#...............................................#..#.#...................#.........#..#...........\n" +
            "................#..#....#..#......................##...............##...#.##...#..................#.....#.......#..................\n" +
            ".#......#...#...............#.........................#...#.............#.....#............................#.................#..#..\n" +
            ".................##....##........................#.......#.#...........#......................##.......#.............#...#..#......\n" +
            ".#..........#....#................##....#.............#.......#...#...#......#...#.................#....#....................#...#.\n" +
            "..................##..#.#.##..#.#...........................#.................##..........#.....................#..........#....#..\n" +
            "....................#...#............#..#................#...#.#...........#..#............#......##....#.....##..............#....\n" +
            ".#..#......#........#.........#......#..#................#.#...#..#.#......#.............#.#.....#....###...#.#....##..............\n" +
            "....#......#.#..#................#.#...#................#...#.......#.#.#..............#......................#..#.....#........#..\n" +
            "........#.............#...##.#.#...#......#................#........#...#...............#.#.......#........##.#...#.......#......#.\n" +
            ".........................##..#......#.#.....#.........##....#............#..........#.............#......#....#............#...#...\n" +
            "...#.....#..#.....#.........#..#..#.##.................................#.............#......##............#....#..#......#.......#.\n" +
            "..#...#....#.#.#...#...#..#...#............##.............................#..................##..............#...................#.\n" +
            "..#..#.....##.............#...........#...#...#.#..........#.......#....#...........#........#........##.......#.......#...........\n" +
            "........#.#...#...........#..###...........#.....#................#.................##.........#.....#....#....#.....#.#.......#.#.\n" +
            "...#......#..............#....#...##...#..###.....#.........#.......#....................#...#.........##..........#..#..........#.\n" +
            ".....#.#....................#........#....###.#..............####....................................#.#...#..#...........#....#...\n" +
            "...#.#...##...#.........#...#............#.....#...#............#...#.........#..#...........................#..#............#.....\n" +
            ".#...#.#..###..................#...#..........#......#........#.#................#.......................##.###.....#.#............\n" +
            ".....................#.#..#.....#.#..#............................................#..#.......#...#.#.........##.....#..............\n" +
            "...#............##.......#...#.##..#........##...#....#....................#.#......#.#....................##.#...#..#....#..#.....\n" +
            "........#....#..........................#...#...........................................#...#..............#..........##.......#...\n" +
            "..............#..#............##......#..#.#......#....#.........................#.....#..#..#...#..........##.....#..........#....\n" +
            "..........#....##........#....#..#....#.................#.................#.#...............#.......#....#...#...............#..#..\n" +
            "...............#..#......#..........#...#......#......##.#..............#.#..........#...#......#..#....#................#..#...#..\n" +
            "...................................................................................................................................\n";

    public static void main(String[] args) {

        String[] ss = s.split("\n");
        int[][] mat = new int[ss.length][ss[0].length()];
        for (int i = 0; i < ss.length; i++) {
            char[] ca = ss[i].toCharArray();
            for (int j = 0; j < ca.length; j++) {
                if (ca[j] == '#') {
                    mat[i][j] = 1;
                } else {
                    mat[i][j] = 0;
                }
            }
        }

        int sx = ss.length;
        int sy = ss[0].length();

        int steps = 500;
        Queue<String> queue = new ArrayDeque<>();
//        queue.add("65,65");
        queue.add("5,5");

        for (int i = 0; i < steps; i++) {
            Set<String> nextVisits = new HashSet<>();
            while (!queue.isEmpty()) {
                String p = queue.remove();
                int x = Integer.parseInt(p.split(",")[0]);
                int y = Integer.parseInt(p.split(",")[1]);
                int newx = extracted(sx, x-1);
                int newy = extracted(sy, y);
//                System.out.println(x + " " + newx);
                if (mat[newx][newy] == 0) {
                    nextVisits.add("" + (x-1) + "," + y);
                }
                newx = extracted(sx, x+1);
                newy = extracted(sy, y);
                if (mat[newx][newy] == 0) {
                    nextVisits.add("" + (x+1) + "," + y);
                }

                newx = extracted(sx, x);
                newy = extracted(sy, y - 1);
                if (mat[newx][newy] == 0) {
                    nextVisits.add("" + (x) + "," + (y-1));
                }

                newx = extracted(sx, x);
                newy = extracted(sy, y + 1);
                if (mat[newx][newy] == 0) {
                    nextVisits.add("" + (x) + "," + (y+1));
                }
            }
            queue.addAll(nextVisits);
        }
        System.out.println(queue.size());
    }

    private static int extracted(int sx, int nr) {
        int newx = nr;
        if (nr > 0) {
            newx = nr % sx;
        }
        if (nr < 0) {
            newx = (sx - (Math.abs(nr) % sx)) % sx;
//            System.out.println(newx + " " + nr);
        }
        return newx;
    }

}
